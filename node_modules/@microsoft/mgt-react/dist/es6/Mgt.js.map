{"version":3,"file":"Mgt.js","sourceRoot":"","sources":["../../src/Mgt.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React, { ReactNode, ReactElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Wc, WcProps, WcTypeProps } from 'wc-react';\n\nexport class Mgt extends Wc {\n  private _templates: Record<string, ReactElement>;\n\n  constructor(props: WcTypeProps) {\n    super(props);\n\n    this.handleTemplateRendered = this.handleTemplateRendered.bind(this);\n  }\n\n  protected getTag() {\n    let tag = super.getTag();\n    if (!tag.startsWith('mgt-')) {\n      tag = 'mgt-' + tag;\n    }\n\n    return tag;\n  }\n\n  public render() {\n    const tag = this.getTag();\n    if (!tag) {\n      throw '\"wcType\" must be set!';\n    }\n\n    this.processTemplates(this.props.children);\n\n    let templateElements = [];\n\n    if (this._templates) {\n      for (let t in this._templates) {\n        if (this._templates.hasOwnProperty(t)) {\n          const element = React.createElement('template', { key: t, 'data-type': t }, null);\n          templateElements.push(element);\n        }\n      }\n    }\n\n    return React.createElement(tag, { ref: (element: HTMLElement) => this.setRef(element) }, templateElements);\n  }\n\n  /**\n   * Sets the web component reference and syncs the props\n   *\n   * @protected\n   * @param {HTMLElement} element\n   * @memberof Wc\n   */\n  protected setRef(component: HTMLElement) {\n    if (component) {\n      component.addEventListener('templateRendered', this.handleTemplateRendered);\n    }\n    super.setRef(component);\n  }\n\n  /**\n   * Removes all event listeners from web component element\n   *\n   * @protected\n   * @returns\n   * @memberof Mgt\n   */\n  protected cleanUp() {\n    if (!this.element) {\n      return;\n    }\n\n    this.element.removeEventListener('templateRendered', this.handleTemplateRendered);\n\n    super.cleanUp();\n  }\n\n  /**\n   * Renders a template\n   *\n   * @protected\n   * @param {*} e\n   * @returns\n   * @memberof Mgt\n   */\n  protected handleTemplateRendered(e) {\n    if (!this._templates) {\n      return;\n    }\n\n    let templateType = e.detail.templateType;\n    let dataContext = e.detail.context;\n    let element = e.detail.element;\n\n    let template = this._templates[templateType];\n\n    if (template) {\n      template = React.cloneElement(template, { dataContext });\n      ReactDOM.render(template, element);\n    }\n  }\n\n  /**\n   * Prepares templates for rendering\n   *\n   * @protected\n   * @param {ReactNode} children\n   * @returns\n   * @memberof Mgt\n   */\n  protected processTemplates(children: ReactNode) {\n    if (!children) {\n      return;\n    }\n\n    let templates = {};\n\n    React.Children.forEach(children, child => {\n      let element = child as ReactElement;\n      if (element && element.props && element.props.template) {\n        templates[element.props.template] = element;\n      } else {\n        templates['default'] = element;\n      }\n    });\n\n    this._templates = templates;\n  }\n}\n\n/**\n * Creates a new React Functional Component that wraps the\n * web component with the specified tag name\n *\n * @template T - optional props type for component\n * @param {(string | Function)} tag\n * @returns React component\n */\nexport const wrapMgt = <T = WcProps>(tag: string) => {\n  const component: React.ForwardRefExoticComponent<\n    React.PropsWithoutRef<T & React.HTMLAttributes<any>> & React.RefAttributes<unknown>\n  > = React.forwardRef((props: T, ref) => React.createElement(Mgt, { wcType: tag, innerRef: ref, ...props }));\n  return component;\n};\n"]}